# Agent CLI

The CLI allows you to perform various tasks related to the computation and management of algorithms, datasets and TEE. The CLI is a gRPC client for the agent service. To communicate with agent, digital signatures are required for auth against the roles such dataset provider.

## Build

To build the CLI, follow these steps:

1. Clone the repository: `go get github.com/ultravioletrs/cocos`.
2. Navigate to the project root: `cd cocos`.
3. Build the CLI binary: `make cli`.

## Usage

#### Generate Keys

To generate a public & private key pair, run the following command:

```bash
./build/cocos-cli keys
```

This will generate a key pair of type rsa. Different key types can be generated using the `-k` flag. Currently supported types on cocos are rsa, ecdsa and ed25519.

```bash
./build/cocos-cli keys -k ecdsa
```

#### Upload Algorithm

To upload an algorithm, use the following command:

```bash
export AGENT_GRPC_URL=<agent_host:agent_host>

./build/cocos-cli algo /path/to/algorithm /path/to/private/key
```

Currently, support is provided for two types of algorithms: executable binaries and python files. The above command expects an algorithm in the binary format which will be executed inside agent. For python files, the algo file is required, along with the requirements file and the python runtime. To run a python file, use the following command:

```bash
export AGENT_GRPC_URL=<agent_host:agent_host>

./build/cocos-cli algo /path/to/algorithm /path/to/private/key --algorithm python --requirements /path/to/requirements.txt --python-runtime python
```

The agent grpc url is required for this operation, this will be available once the TEE has been provisioned and agent is running.

#### Upload Dataset

To upload a dataset, use the following command:

```bash
export AGENT_GRPC_URL=<agent_host:agent_host>

./build/cocos-cli data /path/to/dataset.csv /path/to/private/key
```

The agent grpc url is required for this operation, this will be available once the TEE has been provisioned and agent is running.

#### Retrieve Result

To retrieve the computation result, use the following command:

```bash
export AGENT_GRPC_URL=<agent_host:agent_host>

./build/cocos-cli result /path/to/private/key
```

If the result is available and agent is ready to receive the results, the result will be extracted and written to the current directory as `result.bin`.

The agent grpc url is required for this operation, this will be available once the TEE has been provisioned and agent is running.

### Fetch and Validate Attestation Report

To fetch or validate the attestation report, use the following commands.

To fetch attestation report:
```bash
./build/cocos-cli attestation get report <report_data>
```

To validate attestation report
```bash
./build/cocos-cli attestation validate <attestation_report_file_path>
```

### File Hash

To run a computation, the hash of the files to be uploaded is provided along with the computation manifest. The file hash can be generated by cli, and this can be done using the following command:

```bash
./build/cocos-cli file-hash /path/to/file
```

### Backend Info

To change or add information about the backend, the following commands can be used.

To add measurement data:

```bash
./build/cocos-cli backend measurement <measurement> <backend_info.json>
```

To add host data:

```bash
./build/cocos-cli attestation hostdata <host-data> <backend_info.json>
```

The backend information is obtained from the backend that has SEV. Check [backend info readme](https://github.com/ultravioletrs/cocos/blob/main/scripts/backend_info/README.md) for information on how to run the script to generate backend info.

### Fetch AMD SEV-SNPs CA Bundle (ASK and ARK)

To fetch the CA bundle for SEV-SNP, use the following commands:

```bash
./build/cocos-cli ca-bundle <path_to_platform_info.json>
```

## Installation

To install the CLI locally, i.e. for the current user:

Run `make install-cli`.

## Notes

- The CLI supports various configuration flags and options
- Use the `--help` flag with any command to see additionalinformation
- The CLI uses gRPC for communication with the Agent service
- All traffic between CLI and the TEE is encrypted via mutual TLS
